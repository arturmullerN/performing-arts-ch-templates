<ol class="page-breadcrumb">
    <li>
        <mp-link title="Home" url="/">Home</mp-link>
    </li>
    <li class="active">
        [[> sapaModule:RecordLabel ]]
    </li>
</ol>

<div class="page">

  [[> sapaModule:RecordNavTabHeader defaultImage="../images/fcs/places.svg"]] 
  
  <bs-tabs class='page__body-navtabs' default-active-key='about' unmount-on-exit=true>
    <bs-tab event-key='about' title='About'>
     <div data-flex-layout='row top-stretch'>

        <div style="padding: 15px ;width: 33%" class='table-responsive'>
            <semantic-query 
                query='SELECT ?name ?lang WHERE { 
                    ?? rdfs:label ?name . 
                    BIND( LANG(?name) AS ?lang).
                }' 
                template='<div><h4>Name</h4><ul>{{#each bindings}}<li>{{name.value}} ({{lang.value}})</li>{{/each}}</ul></div>'>
            </semantic-query>
        </div>

       <div style="padding: 15px; width: 33%" data-flex-self='size-xsmall'>
            <div class="pull-left">
                <h4>Place Hierarchy</h4>
                <semantic-tree
                     query='SELECT DISTINCT ?node ?parent WHERE {
                        { 
                          { ?? crm:P89_falls_within* ?node }
                          UNION
                          { ?node crm:P89_falls_within* ?? } 
                          ?referrer crm:P89_falls_within ?node .
                        }
                        OPTIONAL { ?node crm:P89_falls_within ?parent. FILTER(ISIRI(?parent)) }
                        FILTER(ISIRI(?node))
                        FILTER(CONTAINS(STR(?node),"/p/"))
                      }
                   '
                   collapsed="true"
                   keys-opened='[[this]]'
                   parentBindingName="parent"
                   nodeBindingName="node"> 
                </semantic-tree>
            </div>
        </div>

        <div style="padding: 15px ;width: 33%" class='table-responsive'>
            [[> sapa:WikiPlaceMap]]
            <br>
            <semantic-query 
            query='SELECT ?value ?label WHERE {
                ?? owl:sameAs ?value
                BIND (replace(str(?value), ".*\\/", "") as ?localname)
                BIND (strbefore(str(?value), ?localname) as ?prefix)

                VALUES (?prefix  ?source)
                {
                  ("http://www.wikidata.org/entity/"  "Wikidata")
                  ("http://classifications.data.admin.ch/municipality/" "Swiss  Municipality")
                  ("http://geonames.org/" "Geonames")
                  ("http://d-nb.info/gnd/" "GND")
                  ("http://viaf.org/viaf/" "VIAF")
                  ("https://www.wikidata.org/wiki/" "WikiData")
                  ("http://classifications.data.admin.ch/canton/" "Swiss  Municipality")
                }
                BIND  ( CONCAT(?source," [",?localname,"]") as ?label)
                }'
            template='<div style="padding: 15px;"><h4>External Databases</h4>
            <ul>{{#each bindings}}<li><a target="_blank" href="{{value.value}}"> {{label.value}} </a></li>
              {{/each}}
            </ul></div>'>
            </semantic-query>
        </div>

    </div><!-- end flex row --> 

</bs-tab>
<bs-tab event-key="2" title="Groups and Venues">

  <div data-flex-layout='row top-stretch'>

        <div style="padding: 15px; width: 50%" class='table-responsive'>
            <semantic-query 
                query='SELECT ?value ?label WHERE {
                  ?site crm:P89_falls_within ?? .
                  ?value crm:P74_has_current_or_former_residence ?site ;
                    rdfs:label ?label .
                } ORDER BY lcase(?label)'
                template='<div><h4>Groups</h4><ul>{{#each bindings}}<li><semantic-link uri="{{value.value}}">{{label.value}}</semantic-link></li>{{/each}}</ul></div>'>
            </semantic-query>
        </div>

        <div style="padding: 15px; width: 50%" class='table-responsive'>
            <semantic-query 
                query='SELECT ?value ?label WHERE {
                  ?site crm:P89_falls_within ?? .
                  ?value crm:P156_occupies ?site ;
                    crm:P2_has_type spav:dwmkn ;
                    rdfs:label ?label .
                } ORDER BY lcase(?label)'
                template='<div><h4>Venues</h4><ul>{{#each bindings}}<li><semantic-link uri="{{value.value}}">{{label.value}}</semantic-link></li>{{/each}}</ul></div>'>
            </semantic-query>
        </div>

  </div>

</bs-tab>

[[> sapaModule:PlaceEditingTab]]

</bs-tabs>  
</div>
